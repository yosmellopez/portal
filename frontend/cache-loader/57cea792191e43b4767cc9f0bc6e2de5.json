{"remainingRequest":"C:\\wamp64\\www\\portal\\node_modules\\thread-loader\\dist\\cjs.js??ref--9-2!C:\\wamp64\\www\\portal\\node_modules\\ts-loader\\index.js??ref--9-3!C:\\wamp64\\www\\portal\\node_modules\\eslint-loader\\dist\\cjs.js!C:\\wamp64\\www\\portal\\frontend\\app\\core\\tracker\\tracker.service.ts","dependencies":[{"path":"C:\\wamp64\\www\\portal\\frontend\\app\\core\\tracker\\tracker.service.ts","mtime":1568416781302},{"path":"C:\\wamp64\\www\\portal\\node_modules\\angular2-template-loader\\index.js","mtime":1486570058000},{"path":"C:\\wamp64\\www\\portal\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\wamp64\\www\\portal\\node_modules\\thread-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\wamp64\\www\\portal\\node_modules\\ts-loader\\index.js","mtime":499162500000},{"path":"C:\\wamp64\\www\\portal\\node_modules\\eslint-loader\\dist\\cjs.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICogYXMgdHNsaWJfMSBmcm9tICJ0c2xpYiI7DQp2YXIgX2EsIF9iLCBfYywgX2Q7DQppbXBvcnQgeyBJbmplY3RhYmxlIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7DQppbXBvcnQgeyBSb3V0ZXIsIE5hdmlnYXRpb25FbmQgfSBmcm9tICdAYW5ndWxhci9yb3V0ZXInOw0KaW1wb3J0IHsgT2JzZXJ2YWJsZSB9IGZyb20gJ3J4anMnOw0KaW1wb3J0IHsgTG9jYXRpb24gfSBmcm9tICdAYW5ndWxhci9jb21tb24nOw0KaW1wb3J0IHsgQ1NSRlNlcnZpY2UgfSBmcm9tICcuLi9hdXRoL2NzcmYuc2VydmljZSc7DQppbXBvcnQgeyBBdXRoU2VydmVyUHJvdmlkZXIgfSBmcm9tICcuLi9hdXRoL2F1dGgtand0LnNlcnZpY2UnOw0KaW1wb3J0ICogYXMgU29ja0pTIGZyb20gJ3NvY2tqcy1jbGllbnQnOw0KaW1wb3J0ICogYXMgU3RvbXAgZnJvbSAnd2Vic3RvbXAtY2xpZW50JzsNCmxldCBKaGlUcmFja2VyU2VydmljZSA9IGNsYXNzIEpoaVRyYWNrZXJTZXJ2aWNlIHsNCiAgICBjb25zdHJ1Y3Rvcihyb3V0ZXIsIGF1dGhTZXJ2ZXJQcm92aWRlciwgbG9jYXRpb24sIGNzcmZTZXJ2aWNlKSB7DQogICAgICAgIHRoaXMucm91dGVyID0gcm91dGVyOw0KICAgICAgICB0aGlzLmF1dGhTZXJ2ZXJQcm92aWRlciA9IGF1dGhTZXJ2ZXJQcm92aWRlcjsNCiAgICAgICAgdGhpcy5sb2NhdGlvbiA9IGxvY2F0aW9uOw0KICAgICAgICB0aGlzLmNzcmZTZXJ2aWNlID0gY3NyZlNlcnZpY2U7DQogICAgICAgIHRoaXMuc3RvbXBDbGllbnQgPSBudWxsOw0KICAgICAgICB0aGlzLnN1YnNjcmliZXIgPSBudWxsOw0KICAgICAgICB0aGlzLmFscmVhZHlDb25uZWN0ZWRPbmNlID0gZmFsc2U7DQogICAgICAgIHRoaXMuY29ubmVjdGlvbiA9IHRoaXMuY3JlYXRlQ29ubmVjdGlvbigpOw0KICAgICAgICB0aGlzLmxpc3RlbmVyID0gdGhpcy5jcmVhdGVMaXN0ZW5lcigpOw0KICAgIH0NCiAgICBjb25uZWN0KCkgew0KICAgICAgICBpZiAodGhpcy5jb25uZWN0ZWRQcm9taXNlID09PSBudWxsKSB7DQogICAgICAgICAgICB0aGlzLmNvbm5lY3Rpb24gPSB0aGlzLmNyZWF0ZUNvbm5lY3Rpb24oKTsNCiAgICAgICAgfQ0KICAgICAgICAvLyBidWlsZGluZyBhYnNvbHV0ZSBwYXRoIHNvIHRoYXQgd2Vic29ja2V0IGRvZXNuJ3QgZmFpbCB3aGVuIGRlcGxveWluZyB3aXRoIGEgY29udGV4dCBwYXRoDQogICAgICAgIGxldCB1cmwgPSAnL3dlYnNvY2tldC90cmFja2VyJzsNCiAgICAgICAgdXJsID0gdGhpcy5sb2NhdGlvbi5wcmVwYXJlRXh0ZXJuYWxVcmwodXJsKTsNCiAgICAgICAgY29uc3QgYXV0aFRva2VuID0gdGhpcy5hdXRoU2VydmVyUHJvdmlkZXIuZ2V0VG9rZW4oKTsNCiAgICAgICAgaWYgKGF1dGhUb2tlbikgew0KICAgICAgICAgICAgdXJsICs9ICc/YWNjZXNzX3Rva2VuPScgKyBhdXRoVG9rZW47DQogICAgICAgIH0NCiAgICAgICAgY29uc3Qgc29ja2V0ID0gbmV3IFNvY2tKUyh1cmwpOw0KICAgICAgICB0aGlzLnN0b21wQ2xpZW50ID0gU3RvbXAub3Zlcihzb2NrZXQpOw0KICAgICAgICBjb25zdCBoZWFkZXJzID0ge307DQogICAgICAgIHRoaXMuc3RvbXBDbGllbnQuY29ubmVjdChoZWFkZXJzLCAoKSA9PiB7DQogICAgICAgICAgICB0aGlzLmNvbm5lY3RlZFByb21pc2UoJ3N1Y2Nlc3MnKTsNCiAgICAgICAgICAgIHRoaXMuY29ubmVjdGVkUHJvbWlzZSA9IG51bGw7DQogICAgICAgICAgICB0aGlzLnNlbmRBY3Rpdml0eSgpOw0KICAgICAgICAgICAgaWYgKCF0aGlzLmFscmVhZHlDb25uZWN0ZWRPbmNlKSB7DQogICAgICAgICAgICAgICAgdGhpcy5zdWJzY3JpcHRpb24gPSB0aGlzLnJvdXRlci5ldmVudHMuc3Vic2NyaWJlKGV2ZW50ID0+IHsNCiAgICAgICAgICAgICAgICAgICAgaWYgKGV2ZW50IGluc3RhbmNlb2YgTmF2aWdhdGlvbkVuZCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zZW5kQWN0aXZpdHkoKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICAgIHRoaXMuYWxyZWFkeUNvbm5lY3RlZE9uY2UgPSB0cnVlOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9KTsNCiAgICB9DQogICAgZGlzY29ubmVjdCgpIHsNCiAgICAgICAgaWYgKHRoaXMuc3RvbXBDbGllbnQgIT09IG51bGwpIHsNCiAgICAgICAgICAgIHRoaXMuc3RvbXBDbGllbnQuZGlzY29ubmVjdCgpOw0KICAgICAgICAgICAgdGhpcy5zdG9tcENsaWVudCA9IG51bGw7DQogICAgICAgIH0NCiAgICAgICAgaWYgKHRoaXMuc3Vic2NyaXB0aW9uKSB7DQogICAgICAgICAgICB0aGlzLnN1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpOw0KICAgICAgICAgICAgdGhpcy5zdWJzY3JpcHRpb24gPSBudWxsOw0KICAgICAgICB9DQogICAgICAgIHRoaXMuYWxyZWFkeUNvbm5lY3RlZE9uY2UgPSBmYWxzZTsNCiAgICB9DQogICAgcmVjZWl2ZSgpIHsNCiAgICAgICAgcmV0dXJuIHRoaXMubGlzdGVuZXI7DQogICAgfQ0KICAgIHNlbmRBY3Rpdml0eSgpIHsNCiAgICAgICAgaWYgKHRoaXMuc3RvbXBDbGllbnQgIT09IG51bGwgJiYgdGhpcy5zdG9tcENsaWVudC5jb25uZWN0ZWQpIHsNCiAgICAgICAgICAgIHRoaXMuc3RvbXBDbGllbnQuc2VuZCgnL3RvcGljL2FjdGl2aXR5JywgLy8gZGVzdGluYXRpb24NCiAgICAgICAgICAgIEpTT04uc3RyaW5naWZ5KHsgcGFnZTogdGhpcy5yb3V0ZXIucm91dGVyU3RhdGUuc25hcHNob3QudXJsIH0pLCAvLyBib2R5DQogICAgICAgICAgICB7fSAvLyBoZWFkZXINCiAgICAgICAgICAgICk7DQogICAgICAgIH0NCiAgICB9DQogICAgc3Vic2NyaWJlKCkgew0KICAgICAgICB0aGlzLmNvbm5lY3Rpb24udGhlbigoKSA9PiB7DQogICAgICAgICAgICB0aGlzLnN1YnNjcmliZXIgPSB0aGlzLnN0b21wQ2xpZW50LnN1YnNjcmliZSgnL3RvcGljL3RyYWNrZXInLCBkYXRhID0+IHsNCiAgICAgICAgICAgICAgICB0aGlzLmxpc3RlbmVyT2JzZXJ2ZXIubmV4dChKU09OLnBhcnNlKGRhdGEuYm9keSkpOw0KICAgICAgICAgICAgfSk7DQogICAgICAgIH0pOw0KICAgIH0NCiAgICB1bnN1YnNjcmliZSgpIHsNCiAgICAgICAgaWYgKHRoaXMuc3Vic2NyaWJlciAhPT0gbnVsbCkgew0KICAgICAgICAgICAgdGhpcy5zdWJzY3JpYmVyLnVuc3Vic2NyaWJlKCk7DQogICAgICAgIH0NCiAgICAgICAgdGhpcy5saXN0ZW5lciA9IHRoaXMuY3JlYXRlTGlzdGVuZXIoKTsNCiAgICB9DQogICAgY3JlYXRlTGlzdGVuZXIoKSB7DQogICAgICAgIHJldHVybiBuZXcgT2JzZXJ2YWJsZShvYnNlcnZlciA9PiB7DQogICAgICAgICAgICB0aGlzLmxpc3RlbmVyT2JzZXJ2ZXIgPSBvYnNlcnZlcjsNCiAgICAgICAgfSk7DQogICAgfQ0KICAgIGNyZWF0ZUNvbm5lY3Rpb24oKSB7DQogICAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiAodGhpcy5jb25uZWN0ZWRQcm9taXNlID0gcmVzb2x2ZSkpOw0KICAgIH0NCn07DQpKaGlUcmFja2VyU2VydmljZSA9IHRzbGliXzEuX19kZWNvcmF0ZShbDQogICAgSW5qZWN0YWJsZSh7IHByb3ZpZGVkSW46ICdyb290JyB9KSwNCiAgICB0c2xpYl8xLl9fbWV0YWRhdGEoImRlc2lnbjpwYXJhbXR5cGVzIiwgW3R5cGVvZiAoX2EgPSB0eXBlb2YgUm91dGVyICE9PSAidW5kZWZpbmVkIiAmJiBSb3V0ZXIpID09PSAiZnVuY3Rpb24iID8gX2EgOiBPYmplY3QsIHR5cGVvZiAoX2IgPSB0eXBlb2YgQXV0aFNlcnZlclByb3ZpZGVyICE9PSAidW5kZWZpbmVkIiAmJiBBdXRoU2VydmVyUHJvdmlkZXIpID09PSAiZnVuY3Rpb24iID8gX2IgOiBPYmplY3QsIHR5cGVvZiAoX2MgPSB0eXBlb2YgTG9jYXRpb24gIT09ICJ1bmRlZmluZWQiICYmIExvY2F0aW9uKSA9PT0gImZ1bmN0aW9uIiA/IF9jIDogT2JqZWN0LCB0eXBlb2YgKF9kID0gdHlwZW9mIENTUkZTZXJ2aWNlICE9PSAidW5kZWZpbmVkIiAmJiBDU1JGU2VydmljZSkgPT09ICJmdW5jdGlvbiIgPyBfZCA6IE9iamVjdF0pDQpdLCBKaGlUcmFja2VyU2VydmljZSk7DQpleHBvcnQgeyBKaGlUcmFja2VyU2VydmljZSB9Ow0K"},{"version":3,"file":"C:\\wamp64\\www\\portal\\frontend\\app\\core\\tracker\\tracker.service.ts","sourceRoot":"","sources":["C:\\wamp64\\www\\portal\\node_modules\\eslint-loader\\dist\\cjs.js!C:\\wamp64\\www\\portal\\frontend\\app\\core\\tracker\\tracker.service.ts"],"names":[],"mappings":"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","sourcesContent":["import { Injectable } from '@angular/core';\nimport { Router, NavigationEnd } from '@angular/router';\nimport { Observable, Observer, Subscription } from 'rxjs';\nimport { Location } from '@angular/common';\n\nimport { CSRFService } from '../auth/csrf.service';\nimport { AuthServerProvider } from '../auth/auth-jwt.service';\n\nimport * as SockJS from 'sockjs-client';\nimport * as Stomp from 'webstomp-client';\n\n@Injectable({ providedIn: 'root' })\nexport class JhiTrackerService {\n  stompClient = null;\n  subscriber = null;\n  connection: Promise<any>;\n  connectedPromise: any;\n  listener: Observable<any>;\n  listenerObserver: Observer<any>;\n  alreadyConnectedOnce = false;\n  private subscription: Subscription;\n\n  constructor(\n    private router: Router,\n    private authServerProvider: AuthServerProvider,\n    private location: Location,\n    private csrfService: CSRFService\n  ) {\n    this.connection = this.createConnection();\n    this.listener = this.createListener();\n  }\n\n  connect() {\n    if (this.connectedPromise === null) {\n      this.connection = this.createConnection();\n    }\n    // building absolute path so that websocket doesn't fail when deploying with a context path\n    let url = '/websocket/tracker';\n    url = this.location.prepareExternalUrl(url);\n    const authToken = this.authServerProvider.getToken();\n    if (authToken) {\n      url += '?access_token=' + authToken;\n    }\n    const socket = new SockJS(url);\n    this.stompClient = Stomp.over(socket);\n    const headers = {};\n    this.stompClient.connect(headers, () => {\n      this.connectedPromise('success');\n      this.connectedPromise = null;\n      this.sendActivity();\n      if (!this.alreadyConnectedOnce) {\n        this.subscription = this.router.events.subscribe(event => {\n          if (event instanceof NavigationEnd) {\n            this.sendActivity();\n          }\n        });\n        this.alreadyConnectedOnce = true;\n      }\n    });\n  }\n\n  disconnect() {\n    if (this.stompClient !== null) {\n      this.stompClient.disconnect();\n      this.stompClient = null;\n    }\n    if (this.subscription) {\n      this.subscription.unsubscribe();\n      this.subscription = null;\n    }\n    this.alreadyConnectedOnce = false;\n  }\n\n  receive() {\n    return this.listener;\n  }\n\n  sendActivity() {\n    if (this.stompClient !== null && this.stompClient.connected) {\n      this.stompClient.send(\n        '/topic/activity', // destination\n        JSON.stringify({ page: this.router.routerState.snapshot.url }), // body\n        {} // header\n      );\n    }\n  }\n\n  subscribe() {\n    this.connection.then(() => {\n      this.subscriber = this.stompClient.subscribe('/topic/tracker', data => {\n        this.listenerObserver.next(JSON.parse(data.body));\n      });\n    });\n  }\n\n  unsubscribe() {\n    if (this.subscriber !== null) {\n      this.subscriber.unsubscribe();\n    }\n    this.listener = this.createListener();\n  }\n\n  private createListener(): Observable<any> {\n    return new Observable(observer => {\n      this.listenerObserver = observer;\n    });\n  }\n\n  private createConnection(): Promise<any> {\n    return new Promise((resolve, reject) => (this.connectedPromise = resolve));\n  }\n}\n"]}]}
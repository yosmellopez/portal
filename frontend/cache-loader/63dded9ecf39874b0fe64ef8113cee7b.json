{"remainingRequest":"D:\\Programacion\\EspacioPHP\\portalventura\\node_modules\\thread-loader\\dist\\cjs.js??ref--9-2!D:\\Programacion\\EspacioPHP\\portalventura\\node_modules\\ts-loader\\index.js??ref--9-3!D:\\Programacion\\EspacioPHP\\portalventura\\node_modules\\eslint-loader\\dist\\cjs.js!D:\\Programacion\\EspacioPHP\\portalventura\\frontend\\app\\core\\auth\\user-route-access-service.ts","dependencies":[{"path":"D:\\Programacion\\EspacioPHP\\portalventura\\frontend\\app\\core\\auth\\user-route-access-service.ts","mtime":1582472321964},{"path":"D:\\Programacion\\EspacioPHP\\portalventura\\node_modules\\angular2-template-loader\\index.js","mtime":1486570058000},{"path":"D:\\Programacion\\EspacioPHP\\portalventura\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\Programacion\\EspacioPHP\\portalventura\\node_modules\\thread-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\Programacion\\EspacioPHP\\portalventura\\node_modules\\ts-loader\\index.js","mtime":499162500000},{"path":"D:\\Programacion\\EspacioPHP\\portalventura\\node_modules\\eslint-loader\\dist\\cjs.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:dmFyIF9hLCBfYiwgX2M7DQppbXBvcnQgKiBhcyB0c2xpYl8xIGZyb20gInRzbGliIjsNCmltcG9ydCB7IEluamVjdGFibGUsIGlzRGV2TW9kZSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnOw0KaW1wb3J0IHsgUm91dGVyIH0gZnJvbSAnQGFuZ3VsYXIvcm91dGVyJzsNCmltcG9ydCB7IEFjY291bnRTZXJ2aWNlIH0gZnJvbSAnYXBwL2NvcmUvYXV0aC9hY2NvdW50LnNlcnZpY2UnOw0KaW1wb3J0IHsgTG9naW5Nb2RhbFNlcnZpY2UgfSBmcm9tICdhcHAvY29yZS9sb2dpbi9sb2dpbi1tb2RhbC5zZXJ2aWNlJzsNCmltcG9ydCB7IG1hcCB9IGZyb20gInJ4anMvb3BlcmF0b3JzIjsNCmxldCBVc2VyUm91dGVBY2Nlc3NTZXJ2aWNlID0gY2xhc3MgVXNlclJvdXRlQWNjZXNzU2VydmljZSB7DQogICAgY29uc3RydWN0b3Iocm91dGVyLCBsb2dpbk1vZGFsU2VydmljZSwgYWNjb3VudFNlcnZpY2UpIHsNCiAgICAgICAgdGhpcy5yb3V0ZXIgPSByb3V0ZXI7DQogICAgICAgIHRoaXMubG9naW5Nb2RhbFNlcnZpY2UgPSBsb2dpbk1vZGFsU2VydmljZTsNCiAgICAgICAgdGhpcy5hY2NvdW50U2VydmljZSA9IGFjY291bnRTZXJ2aWNlOw0KICAgIH0NCiAgICBjYW5BY3RpdmF0ZShyb3V0ZSwgc3RhdGUpIHsNCiAgICAgICAgY29uc3QgYXV0aG9yaXRpZXMgPSByb3V0ZS5kYXRhWydhdXRob3JpdGllcyddOw0KICAgICAgICAvLyBXZSBuZWVkIHRvIGNhbGwgdGhlIGNoZWNrTG9naW4gLyBhbmQgc28gdGhlIGFjY291bnRTZXJ2aWNlLmlkZW50aXR5KCkgZnVuY3Rpb24sIHRvIGVuc3VyZSwNCiAgICAgICAgLy8gdGhhdCB0aGUgY2xpZW50IGhhcyBhIHByaW5jaXBhbCB0b28sIGlmIHRoZXkgYWxyZWFkeSBsb2dnZWQgaW4gYnkgdGhlIHNlcnZlci4NCiAgICAgICAgLy8gVGhpcyBjb3VsZCBoYXBwZW4gb24gYSBwYWdlIHJlZnJlc2guDQogICAgICAgIHJldHVybiB0aGlzLmNoZWNrTG9naW4oYXV0aG9yaXRpZXMsIHN0YXRlLnVybCk7DQogICAgfQ0KICAgIGNoZWNrTG9naW4oYXV0aG9yaXRpZXMsIHVybCkgew0KICAgICAgICBjb25zdCByZXN1bHQgPSB0aGlzLmFjY291bnRTZXJ2aWNlLmlkZW50aXR5KHRydWUpLnBpcGUobWFwKGFjY291bnQgPT4gew0KICAgICAgICAgICAgY29uc29sZS5sb2coYWNjb3VudCk7DQogICAgICAgICAgICBpZiAoYWNjb3VudCkgew0KICAgICAgICAgICAgICAgIGlmICghYXV0aG9yaXRpZXMgfHwgYXV0aG9yaXRpZXMubGVuZ3RoID09PSAwKSB7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBjb25zdCBoYXNBbnlBdXRob3JpdHkgPSB0aGlzLmFjY291bnRTZXJ2aWNlLmhhc0FueUF1dGhvcml0eShhdXRob3JpdGllcyk7DQogICAgICAgICAgICAgICAgaWYgKGhhc0FueUF1dGhvcml0eSkgew0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgaWYgKGlzRGV2TW9kZSgpKSB7DQogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ1VzZXIgaGFzIG5vdCBhbnkgb2YgcmVxdWlyZWQgYXV0aG9yaXRpZXM6ICcsIGF1dGhvcml0aWVzKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgdGhpcy5yb3V0ZXIubmF2aWdhdGUoWydhY2Nlc3NkZW5pZWQnXSk7DQogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgdGhpcy5yb3V0ZXIubmF2aWdhdGUoWycvbG9naW4nXSk7DQogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9KSk7DQogICAgICAgIHJlc3VsdC5zdWJzY3JpYmUoKCkgPT4gew0KICAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgIH0sIGVycm9yID0+IHsNCiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpOw0KICAgICAgICAgICAgdGhpcy5yb3V0ZXIubmF2aWdhdGUoWycvbG9naW4nXSk7DQogICAgICAgIH0pOw0KICAgICAgICByZXR1cm4gcmVzdWx0Ow0KICAgIH0NCiAgICBjYW5BY3RpdmF0ZUNoaWxkKGNoaWxkUm91dGUsIHN0YXRlKSB7DQogICAgICAgIGNvbnN0IGF1dGhvcml0aWVzID0gY2hpbGRSb3V0ZS5kYXRhWydhdXRob3JpdGllcyddOw0KICAgICAgICByZXR1cm4gdGhpcy5jaGVja0xvZ2luKGF1dGhvcml0aWVzLCBzdGF0ZS51cmwpOw0KICAgIH0NCn07DQpVc2VyUm91dGVBY2Nlc3NTZXJ2aWNlID0gdHNsaWJfMS5fX2RlY29yYXRlKFsNCiAgICBJbmplY3RhYmxlKHsgcHJvdmlkZWRJbjogJ3Jvb3QnIH0pLA0KICAgIHRzbGliXzEuX19tZXRhZGF0YSgiZGVzaWduOnBhcmFtdHlwZXMiLCBbdHlwZW9mIChfYSA9IHR5cGVvZiBSb3V0ZXIgIT09ICJ1bmRlZmluZWQiICYmIFJvdXRlcikgPT09ICJmdW5jdGlvbiIgPyBfYSA6IE9iamVjdCwgdHlwZW9mIChfYiA9IHR5cGVvZiBMb2dpbk1vZGFsU2VydmljZSAhPT0gInVuZGVmaW5lZCIgJiYgTG9naW5Nb2RhbFNlcnZpY2UpID09PSAiZnVuY3Rpb24iID8gX2IgOiBPYmplY3QsIHR5cGVvZiAoX2MgPSB0eXBlb2YgQWNjb3VudFNlcnZpY2UgIT09ICJ1bmRlZmluZWQiICYmIEFjY291bnRTZXJ2aWNlKSA9PT0gImZ1bmN0aW9uIiA/IF9jIDogT2JqZWN0XSkNCl0sIFVzZXJSb3V0ZUFjY2Vzc1NlcnZpY2UpOw0KZXhwb3J0IHsgVXNlclJvdXRlQWNjZXNzU2VydmljZSB9Ow0K"},{"version":3,"file":"D:\\Programacion\\EspacioPHP\\portalventura\\frontend\\app\\core\\auth\\user-route-access-service.ts","sourceRoot":"","sources":["D:\\Programacion\\EspacioPHP\\portalventura\\node_modules\\eslint-loader\\dist\\cjs.js!D:\\Programacion\\EspacioPHP\\portalventura\\frontend\\app\\core\\auth\\user-route-access-service.ts"],"names":[],"mappings":";;AAAA,OAAO,EAAC,UAAU,EAAE,SAAS,EAAC,MAAM,eAAe,CAAC;AACpD,OAAO,EAIH,MAAM,EAGT,MAAM,iBAAiB,CAAC;AAEzB,OAAO,EAAC,cAAc,EAAC,MAAM,+BAA+B,CAAC;AAC7D,OAAO,EAAC,iBAAiB,EAAC,MAAM,oCAAoC,CAAC;AAErE,OAAO,EAAa,GAAG,EAAC,MAAM,gBAAgB,CAAC;AAI/C,IAAa,sBAAsB,GAAnC,MAAa,sBAAsB;IAC/B,YAAoB,MAAc,EAAU,iBAAoC,EAAU,cAA8B;QAApG,WAAM,GAAN,MAAM,CAAQ;QAAU,sBAAiB,GAAjB,iBAAiB,CAAmB;QAAU,mBAAc,GAAd,cAAc,CAAgB;IACxH,CAAC;IAED,WAAW,CAAC,KAA6B,EAAE,KAA0B;QACjE,MAAM,WAAW,GAAG,KAAK,CAAC,IAAI,CAAC,aAAa,CAAC,CAAC;QAC9C,6FAA6F;QAC7F,gFAAgF;QAChF,uCAAuC;QACvC,OAAO,IAAI,CAAC,UAAU,CAAC,WAAW,EAAE,KAAK,CAAC,GAAG,CAAC,CAAC;IACnD,CAAC;IAED,UAAU,CAAC,WAAqB,EAAE,GAAW;QACzC,MAAM,MAAM,GAAG,IAAI,CAAC,cAAc,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC,IAAI,CAClD,GAAG,CAAC,OAAO,CAAC,EAAE;YACV,OAAO,CAAC,GAAG,CAAC,OAAO,CAAC,CAAC;YACrB,IAAI,OAAO,EAAE;gBACT,IAAI,CAAC,WAAW,IAAI,WAAW,CAAC,MAAM,KAAK,CAAC,EAAE;oBAC1C,OAAO,IAAI,CAAC;iBACf;gBACD,MAAM,eAAe,GAAG,IAAI,CAAC,cAAc,CAAC,eAAe,CAAC,WAAW,CAAC,CAAC;gBACzE,IAAI,eAAe,EAAE;oBACjB,OAAO,IAAI,CAAC;iBACf;gBACD,IAAI,SAAS,EAAE,EAAE;oBACb,OAAO,CAAC,KAAK,CAAC,4CAA4C,EAAE,WAAW,CAAC,CAAC;iBAC5E;gBACD,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,CAAC,cAAc,CAAC,CAAC,CAAC;gBACvC,OAAO,KAAK,CAAC;aAChB;iBAAM;gBACH,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,CAAC,QAAQ,CAAC,CAAC,CAAC;gBACjC,OAAO,KAAK,CAAC;aAChB;QACL,CAAC,CAAC,CACL,CAAC;QACF,MAAM,CAAC,SAAS,CAAC,GAAG,EAAE;YAClB,OAAO,IAAI,CAAC;QAChB,CAAC,EAAE,KAAK,CAAC,EAAE;YACP,OAAO,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC;YACrB,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,CAAC,QAAQ,CAAC,CAAC,CAAC;QACrC,CAAC,CAAC,CAAC;QACH,OAAO,MAAM,CAAC;IAClB,CAAC;IAED,gBAAgB,CAAC,UAAkC,EAAE,KAA0B;QAC3E,MAAM,WAAW,GAAG,UAAU,CAAC,IAAI,CAAC,aAAa,CAAC,CAAC;QACnD,OAAO,IAAI,CAAC,UAAU,CAAC,WAAW,EAAE,KAAK,CAAC,GAAG,CAAC,CAAC;IACnD,CAAC;CACJ,CAAA;AAhDY,sBAAsB;IADlC,UAAU,CAAC,EAAC,UAAU,EAAE,MAAM,EAAC,CAAC;iEAED,MAAM,oBAAN,MAAM,oDAA6B,iBAAiB,oBAAjB,iBAAiB,oDAA0B,cAAc,oBAAd,cAAc;GAD/G,sBAAsB,CAgDlC;SAhDY,sBAAsB","sourcesContent":["import {Injectable, isDevMode} from '@angular/core';\r\nimport {\r\n    ActivatedRouteSnapshot,\r\n    CanActivate,\r\n    CanActivateChild,\r\n    Router,\r\n    RouterStateSnapshot,\r\n    UrlTree\r\n} from '@angular/router';\r\n\r\nimport {AccountService} from 'app/core/auth/account.service';\r\nimport {LoginModalService} from 'app/core/login/login-modal.service';\r\nimport {Observable} from \"rxjs\";\r\nimport {catchError, map} from \"rxjs/operators\";\r\nimport {exitCodeFromResult} from \"@angular/compiler-cli\";\r\n\r\n@Injectable({providedIn: 'root'})\r\nexport class UserRouteAccessService implements CanActivate, CanActivateChild {\r\n    constructor(private router: Router, private loginModalService: LoginModalService, private accountService: AccountService) {\r\n    }\r\n\r\n    canActivate(route: ActivatedRouteSnapshot, state: RouterStateSnapshot): Observable<boolean> {\r\n        const authorities = route.data['authorities'];\r\n        // We need to call the checkLogin / and so the accountService.identity() function, to ensure,\r\n        // that the client has a principal too, if they already logged in by the server.\r\n        // This could happen on a page refresh.\r\n        return this.checkLogin(authorities, state.url);\r\n    }\r\n\r\n    checkLogin(authorities: string[], url: string): Observable<boolean> {\r\n        const result = this.accountService.identity(true).pipe(\r\n            map(account => {\r\n                console.log(account);\r\n                if (account) {\r\n                    if (!authorities || authorities.length === 0) {\r\n                        return true;\r\n                    }\r\n                    const hasAnyAuthority = this.accountService.hasAnyAuthority(authorities);\r\n                    if (hasAnyAuthority) {\r\n                        return true;\r\n                    }\r\n                    if (isDevMode()) {\r\n                        console.error('User has not any of required authorities: ', authorities);\r\n                    }\r\n                    this.router.navigate(['accessdenied']);\r\n                    return false;\r\n                } else {\r\n                    this.router.navigate(['/login']);\r\n                    return false;\r\n                }\r\n            })\r\n        );\r\n        result.subscribe(() => {\r\n            return true;\r\n        }, error => {\r\n            console.error(error);\r\n            this.router.navigate(['/login']);\r\n        });\r\n        return result;\r\n    }\r\n\r\n    canActivateChild(childRoute: ActivatedRouteSnapshot, state: RouterStateSnapshot): Observable<boolean | UrlTree> | Promise<boolean | UrlTree> | boolean | UrlTree {\r\n        const authorities = childRoute.data['authorities'];\r\n        return this.checkLogin(authorities, state.url);\r\n    }\r\n}\r\n"]}]}
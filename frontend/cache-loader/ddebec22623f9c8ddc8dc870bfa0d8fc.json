{"remainingRequest":"D:\\Programacion\\EspacioPHP\\portalventura\\node_modules\\thread-loader\\dist\\cjs.js??ref--9-2!D:\\Programacion\\EspacioPHP\\portalventura\\node_modules\\ts-loader\\index.js??ref--9-3!D:\\Programacion\\EspacioPHP\\portalventura\\node_modules\\eslint-loader\\dist\\cjs.js!D:\\Programacion\\EspacioPHP\\portalventura\\frontend\\app\\core\\auth\\account.service.ts","dependencies":[{"path":"D:\\Programacion\\EspacioPHP\\portalventura\\frontend\\app\\core\\auth\\account.service.ts","mtime":1582418197977},{"path":"D:\\Programacion\\EspacioPHP\\portalventura\\node_modules\\angular2-template-loader\\index.js","mtime":1486570058000},{"path":"D:\\Programacion\\EspacioPHP\\portalventura\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\Programacion\\EspacioPHP\\portalventura\\node_modules\\thread-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\Programacion\\EspacioPHP\\portalventura\\node_modules\\ts-loader\\index.js","mtime":499162500000},{"path":"D:\\Programacion\\EspacioPHP\\portalventura\\node_modules\\eslint-loader\\dist\\cjs.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:dmFyIF9hLCBfYiwgX2M7DQppbXBvcnQgKiBhcyB0c2xpYl8xIGZyb20gInRzbGliIjsNCmltcG9ydCB7IEluamVjdGFibGUgfSBmcm9tICdAYW5ndWxhci9jb3JlJzsNCmltcG9ydCB7IEh0dHBDbGllbnQgfSBmcm9tICdAYW5ndWxhci9jb21tb24vaHR0cCc7DQppbXBvcnQgeyBvZiwgU3ViamVjdCB9IGZyb20gJ3J4anMnOw0KaW1wb3J0IHsgU0VSVkVSX0FQSV9VUkwgfSBmcm9tICdhcHAvYXBwLmNvbnN0YW50cyc7DQppbXBvcnQgeyBtYXAsIHNoYXJlUmVwbGF5LCB0YXAgfSBmcm9tICJyeGpzL29wZXJhdG9ycyI7DQppbXBvcnQgeyBKaGlMYW5ndWFnZVNlcnZpY2UgfSBmcm9tICJuZy1qaGlwc3RlciI7DQppbXBvcnQgeyBTZXNzaW9uU3RvcmFnZVNlcnZpY2UgfSBmcm9tICJuZ3gtd2Vic3RvcmFnZSI7DQpsZXQgQWNjb3VudFNlcnZpY2UgPSBjbGFzcyBBY2NvdW50U2VydmljZSB7DQogICAgY29uc3RydWN0b3IoaHR0cCwgbGFuZ3VhZ2VTZXJ2aWNlLCBzZXNzaW9uU3RvcmFnZSkgew0KICAgICAgICB0aGlzLmh0dHAgPSBodHRwOw0KICAgICAgICB0aGlzLmxhbmd1YWdlU2VydmljZSA9IGxhbmd1YWdlU2VydmljZTsNCiAgICAgICAgdGhpcy5zZXNzaW9uU3RvcmFnZSA9IHNlc3Npb25TdG9yYWdlOw0KICAgICAgICB0aGlzLmF1dGhlbnRpY2F0ZWQgPSBmYWxzZTsNCiAgICAgICAgdGhpcy5hdXRoZW50aWNhdGlvblN0YXRlID0gbmV3IFN1YmplY3QoKTsNCiAgICB9DQogICAgZmV0Y2goKSB7DQogICAgICAgIHJldHVybiB0aGlzLmh0dHAuZ2V0KFNFUlZFUl9BUElfVVJMICsgJ2FwaS9hY2NvdW50Jyk7DQogICAgfQ0KICAgIHNhdmUoYWNjb3VudCkgew0KICAgICAgICByZXR1cm4gdGhpcy5odHRwLnBvc3QoU0VSVkVSX0FQSV9VUkwgKyAnYXBpL2FjY291bnQnLCBhY2NvdW50KTsNCiAgICB9DQogICAgYXV0aGVudGljYXRlKGlkZW50aXR5KSB7DQogICAgICAgIHRoaXMudXNlcklkZW50aXR5ID0gaWRlbnRpdHk7DQogICAgICAgIHRoaXMuYXV0aGVudGljYXRlZCA9IGlkZW50aXR5ICE9PSBudWxsOw0KICAgICAgICB0aGlzLmF1dGhlbnRpY2F0aW9uU3RhdGUubmV4dCh0aGlzLnVzZXJJZGVudGl0eSk7DQogICAgfQ0KICAgIGhhc0FueUF1dGhvcml0eShhdXRob3JpdGllcykgew0KICAgICAgICBpZiAoIXRoaXMuYXV0aGVudGljYXRlZCB8fCAhdGhpcy51c2VySWRlbnRpdHkgfHwgIXRoaXMudXNlcklkZW50aXR5LnJvbCkgew0KICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICB9DQogICAgICAgIGlmICghQXJyYXkuaXNBcnJheShhdXRob3JpdGllcykpIHsNCiAgICAgICAgICAgIGF1dGhvcml0aWVzID0gW2F1dGhvcml0aWVzXTsNCiAgICAgICAgfQ0KICAgICAgICBjb25zb2xlLmxvZyhhdXRob3JpdGllcy5pbmNsdWRlcyh0aGlzLnVzZXJJZGVudGl0eS5yb2wucm9sZSkpOw0KICAgICAgICByZXR1cm4gYXV0aG9yaXRpZXMuaW5jbHVkZXModGhpcy51c2VySWRlbnRpdHkucm9sLnJvbGUpOw0KICAgIH0NCiAgICBoYXNBdXRob3JpdHkoYXV0aG9yaXR5KSB7DQogICAgICAgIGlmICghdGhpcy5hdXRoZW50aWNhdGVkKSB7DQogICAgICAgICAgICByZXR1cm4gb2YoZmFsc2UpOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiB0aGlzLmlkZW50aXR5KCkucGlwZShtYXAoYWNjb3VudCA9PiB7DQogICAgICAgICAgICByZXR1cm4gYWNjb3VudC5yb2wgJiYgYWNjb3VudC5yb2wucm9sZSA9PT0gYXV0aG9yaXR5IHx8IGZhbHNlOw0KICAgICAgICB9KSk7DQogICAgfQ0KICAgIGlkZW50aXR5KGZvcmNlKSB7DQogICAgICAgIGlmIChmb3JjZSkgew0KICAgICAgICAgICAgdGhpcy5hY2NvdW50Q2FjaGUkID0gbnVsbDsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoIXRoaXMuYWNjb3VudENhY2hlJCkgew0KICAgICAgICAgICAgdGhpcy5hY2NvdW50Q2FjaGUkID0gdGhpcy5mZXRjaCgpLnBpcGUodGFwKGFjY291bnQgPT4gew0KICAgICAgICAgICAgICAgIGlmIChhY2NvdW50KSB7DQogICAgICAgICAgICAgICAgICAgIHRoaXMudXNlcklkZW50aXR5ID0gYWNjb3VudDsNCiAgICAgICAgICAgICAgICAgICAgdGhpcy5hdXRoZW50aWNhdGVkID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICAgICAgLy8gQWZ0ZXIgcmV0cmlldmUgdGhlIGFjY291bnQgaW5mbywgdGhlIGxhbmd1YWdlIHdpbGwgYmUgY2hhbmdlZCB0bw0KICAgICAgICAgICAgICAgICAgICAvLyB0aGUgdXNlcidzIHByZWZlcnJlZCBsYW5ndWFnZSBjb25maWd1cmVkIGluIHRoZSBhY2NvdW50IHNldHRpbmcNCiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMudXNlcklkZW50aXR5LmxhbmdLZXkpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGxhbmdLZXkgPSB0aGlzLnNlc3Npb25TdG9yYWdlLnJldHJpZXZlKCdsb2NhbGUnKSB8fCB0aGlzLnVzZXJJZGVudGl0eS5sYW5nS2V5Ow0KICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5sYW5ndWFnZVNlcnZpY2UuY2hhbmdlTGFuZ3VhZ2UobGFuZ0tleSk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgICAgIHRoaXMudXNlcklkZW50aXR5ID0gbnVsbDsNCiAgICAgICAgICAgICAgICAgICAgdGhpcy5hdXRoZW50aWNhdGVkID0gZmFsc2U7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHRoaXMuYXV0aGVudGljYXRpb25TdGF0ZS5uZXh0KHRoaXMudXNlcklkZW50aXR5KTsNCiAgICAgICAgICAgIH0sICgpID0+IHsNCiAgICAgICAgICAgICAgICB0aGlzLnVzZXJJZGVudGl0eSA9IG51bGw7DQogICAgICAgICAgICAgICAgdGhpcy5hdXRoZW50aWNhdGVkID0gZmFsc2U7DQogICAgICAgICAgICAgICAgdGhpcy5hdXRoZW50aWNhdGlvblN0YXRlLm5leHQodGhpcy51c2VySWRlbnRpdHkpOw0KICAgICAgICAgICAgfSksIHNoYXJlUmVwbGF5KCkpOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiB0aGlzLmFjY291bnRDYWNoZSQ7DQogICAgfQ0KICAgIGlzQXV0aGVudGljYXRlZCgpIHsNCiAgICAgICAgcmV0dXJuIHRoaXMuYXV0aGVudGljYXRlZDsNCiAgICB9DQogICAgaXNJZGVudGl0eVJlc29sdmVkKCkgew0KICAgICAgICByZXR1cm4gdGhpcy51c2VySWRlbnRpdHkgIT09IHVuZGVmaW5lZDsNCiAgICB9DQogICAgZ2V0QXV0aGVudGljYXRpb25TdGF0ZSgpIHsNCiAgICAgICAgcmV0dXJuIHRoaXMuYXV0aGVudGljYXRpb25TdGF0ZS5hc09ic2VydmFibGUoKTsNCiAgICB9DQogICAgZ2V0SW1hZ2VVcmwoKSB7DQogICAgICAgIHJldHVybiB0aGlzLmlzSWRlbnRpdHlSZXNvbHZlZCgpID8gdGhpcy51c2VySWRlbnRpdHkuaW1hZ2VVcmwgOiBudWxsOw0KICAgIH0NCn07DQpBY2NvdW50U2VydmljZSA9IHRzbGliXzEuX19kZWNvcmF0ZShbDQogICAgSW5qZWN0YWJsZSh7IHByb3ZpZGVkSW46ICdyb290JyB9KSwNCiAgICB0c2xpYl8xLl9fbWV0YWRhdGEoImRlc2lnbjpwYXJhbXR5cGVzIiwgW3R5cGVvZiAoX2EgPSB0eXBlb2YgSHR0cENsaWVudCAhPT0gInVuZGVmaW5lZCIgJiYgSHR0cENsaWVudCkgPT09ICJmdW5jdGlvbiIgPyBfYSA6IE9iamVjdCwgdHlwZW9mIChfYiA9IHR5cGVvZiBKaGlMYW5ndWFnZVNlcnZpY2UgIT09ICJ1bmRlZmluZWQiICYmIEpoaUxhbmd1YWdlU2VydmljZSkgPT09ICJmdW5jdGlvbiIgPyBfYiA6IE9iamVjdCwgdHlwZW9mIChfYyA9IHR5cGVvZiBTZXNzaW9uU3RvcmFnZVNlcnZpY2UgIT09ICJ1bmRlZmluZWQiICYmIFNlc3Npb25TdG9yYWdlU2VydmljZSkgPT09ICJmdW5jdGlvbiIgPyBfYyA6IE9iamVjdF0pDQpdLCBBY2NvdW50U2VydmljZSk7DQpleHBvcnQgeyBBY2NvdW50U2VydmljZSB9Ow0K"},{"version":3,"file":"D:\\Programacion\\EspacioPHP\\portalventura\\frontend\\app\\core\\auth\\account.service.ts","sourceRoot":"","sources":["D:\\Programacion\\EspacioPHP\\portalventura\\node_modules\\eslint-loader\\dist\\cjs.js!D:\\Programacion\\EspacioPHP\\portalventura\\frontend\\app\\core\\auth\\account.service.ts"],"names":[],"mappings":"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","sourcesContent":["import {Injectable} from '@angular/core';\r\nimport {HttpClient, HttpResponse} from '@angular/common/http';\r\nimport {Observable, of, Subject} from 'rxjs';\r\n\r\nimport {SERVER_API_URL} from 'app/app.constants';\r\nimport {Account} from 'app/core/user/account.model';\r\nimport {map, shareReplay, tap} from \"rxjs/operators\";\r\nimport {JhiLanguageService} from \"ng-jhipster\";\r\nimport {SessionStorageService} from \"ngx-webstorage\";\r\n\r\n@Injectable({providedIn: 'root'})\r\nexport class AccountService {\r\n    private userIdentity: Account;\r\n    private authenticated = false;\r\n    private authenticationState = new Subject<any>();\r\n    private accountCache$: Observable<Account>;\r\n\r\n    constructor(private http: HttpClient, private languageService: JhiLanguageService, private sessionStorage: SessionStorageService) {\r\n    }\r\n\r\n    fetch(): Observable<Account> {\r\n        return this.http.get<Account>(SERVER_API_URL + 'api/account');\r\n    }\r\n\r\n    save(account: Account): Observable<Account> {\r\n        return this.http.post<Account>(SERVER_API_URL + 'api/account', account);\r\n    }\r\n\r\n    authenticate(identity) {\r\n        this.userIdentity = identity;\r\n        this.authenticated = identity !== null;\r\n        this.authenticationState.next(this.userIdentity);\r\n    }\r\n\r\n    hasAnyAuthority(authorities: string[] | string): boolean {\r\n        if (!this.authenticated || !this.userIdentity || !this.userIdentity.rol) {\r\n            return false;\r\n        }\r\n\r\n        if (!Array.isArray(authorities)) {\r\n            authorities = [authorities];\r\n        }\r\n        console.log(authorities.includes(this.userIdentity.rol.role));\r\n        return authorities.includes(this.userIdentity.rol.role);\r\n    }\r\n\r\n    hasAuthority(authority: string): Observable<boolean> {\r\n        if (!this.authenticated) {\r\n            return of(false);\r\n        }\r\n        return this.identity().pipe(map(account => {\r\n            return account.rol && account.rol.role === authority || false;\r\n        }));\r\n    }\r\n\r\n    identity(force?: boolean): Observable<Account> {\r\n        if (force) {\r\n            this.accountCache$ = null;\r\n        }\r\n\r\n        if (!this.accountCache$) {\r\n            this.accountCache$ = this.fetch().pipe(\r\n                tap(\r\n                    account => {\r\n                        if (account) {\r\n                            this.userIdentity = account;\r\n                            this.authenticated = true;\r\n                            // After retrieve the account info, the language will be changed to\r\n                            // the user's preferred language configured in the account setting\r\n                            if (this.userIdentity.langKey) {\r\n                                const langKey = this.sessionStorage.retrieve('locale') || this.userIdentity.langKey;\r\n                                this.languageService.changeLanguage(langKey);\r\n                            }\r\n                        } else {\r\n                            this.userIdentity = null;\r\n                            this.authenticated = false;\r\n                        }\r\n                        this.authenticationState.next(this.userIdentity);\r\n                    },\r\n                    () => {\r\n                        this.userIdentity = null;\r\n                        this.authenticated = false;\r\n                        this.authenticationState.next(this.userIdentity);\r\n                    }\r\n                ),\r\n                shareReplay()\r\n            );\r\n        }\r\n        return this.accountCache$;\r\n    }\r\n\r\n    isAuthenticated(): boolean {\r\n        return this.authenticated;\r\n    }\r\n\r\n    isIdentityResolved(): boolean {\r\n        return this.userIdentity !== undefined;\r\n    }\r\n\r\n    getAuthenticationState(): Observable<any> {\r\n        return this.authenticationState.asObservable();\r\n    }\r\n\r\n    getImageUrl(): string {\r\n        return this.isIdentityResolved() ? this.userIdentity.imageUrl : null;\r\n    }\r\n}\r\n"]}]}